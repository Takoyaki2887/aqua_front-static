(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[246],{2383:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/aqua",function(){return n(2964)}])},2964:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return xe}});var i=n(5893),r=n(8527),o=n(7294),a=n(4651);function s(e){return(0,i.jsxs)(r.xu,{width:"100vw",height:"7vh",maxH:"13vh",display:"inline-block",position:"relative",marginBottom:"5px",children:[(0,i.jsx)(r.xu,{width:"40vw",height:"100%",display:"inline-block",position:"absolute",top:0,left:0,children:(0,i.jsx)(r.xu,{height:"100%",width:"50vw",paddingLeft:"20px",children:(0,i.jsx)(a.Ee,{src:"/logo.png",boxSize:"100%",objectFit:"contain",objectPosition:"left center"})})}),(0,i.jsx)(r.xu,{width:"48vw",height:"100%",textAlign:"center",display:"inline-block",position:"absolute",top:0,right:0,children:(0,i.jsx)(r.xu,{height:"4vh",position:"absolute",top:"50%",marginTop:"-2vh",width:"100%",children:(0,i.jsx)(r.xv,{fontSize:["18px","20px","20px","37px","37px","37px"],color:"grey",position:"relative",textAlign:"center",children:"5G Real-time Aqua Monitor"})})})]})}var l=n(7484),d=n.n(l),c=d()().toDate().toString(),u=d()().subtract(7,"day").toDate().toString(),h=["","","",""],p={sid:0,startDate:c,endDate:u,phOffset:1,orpOffset:0,pwData:"",schooldIcon:""},x=(0,o.createContext)(p),f=function(){return(0,o.useContext)(x)},g=function(e){var t=e.children,n=e.sid,r=(0,o.useState)(c),a=r[0],s=r[1],l=(0,o.useState)(u),p=l[0],f=l[1],g=(0,o.useState)(1),v=g[0],m=g[1],j=(0,o.useState)(0),b=j[0],w=j[1],y=(0,o.useState)(Math.random()),S=y[0],k=y[1],C=(0,o.useState)(""),O=C[0],P=C[1],T=h[n+1];return(0,o.useEffect)((function(){var e=d()().toDate().toString(),t=d()().subtract(7,"day").toDate().toString();s(t),f(e),setTimeout((function(){return k(Math.random())}),36e5)}),[S]),(0,i.jsx)(x.Provider,{value:{sid:n,startDate:a,endDate:p,phOffset:v,orpOffset:b,pwData:O,schooldIcon:T,setPhOffset:m,setORPOffset:w,setPwData:P},children:t})},v=n(7568),m=n(7582),j={selectedCam:1},b=(0,o.createContext)(j),w=function(){return(0,o.useContext)(b)},y=function(e){var t=e.children,n=(0,o.useState)(1),r=n[0],a=n[1];return(0,i.jsx)(b.Provider,{value:{selectedCam:r,setSelectedCam:a},children:t})};function S(){var e=(0,o.useState)(d()().format("DD MMM YYYY HH:mm")),t=e[0],n=e[1];return(0,o.useEffect)((function(){setInterval((function(){return n(d()().format("DD MMM YYYY HH:mm"))}),5e4)}),[]),(0,i.jsx)(r.xv,{fontSize:["20px","20px","20px","40px","40px","40px"],color:"#6b6b6b",children:t})}function k(){var e=function(){var e=(0,v.Z)((function(){var e,t,n,i,r,o,s,l,d;return(0,m.__generator)(this,(function(c){switch(c.label){case 0:return[4,fetch("https://aqua-test.silver-lining.hk:2053/stream/list")];case 1:return[4,c.sent().json()];case 2:if(null===(e=c.sent())||void 0===e?void 0:e.data){t=null===e||void 0===e?void 0:e.data,n=[],i=!0,r=!1,o=void 0;try{for(s=t[Symbol.iterator]();!(i=(l=s.next()).done);i=!0)"youtube"===(d=l.value).type&&n.push("https://www.youtube.com/embed/".concat(d.data.videoId,"?autoplay=1&mute=1&controls=0"))}catch(u){r=!0,o=u}finally{try{i||null==s.return||s.return()}finally{if(r)throw o}}a(n)}return[2]}}))}));return function(){return e.apply(this,arguments)}}(),t=(0,o.useState)([]),n=t[0],a=t[1],s=w().selectedCam,l=(0,o.useState)(n[s-1]),d=l[0],c=l[1];return(0,o.useEffect)((function(){e().then()}),[]),(0,o.useEffect)((function(){console.log("camUrls",n),c(n[s-1]),console.log("camId",s),console.log("streamUrl",d)}),[n,s]),(0,i.jsxs)(r.xu,{width:"96vw",height:"86vh",marginX:"auto",borderTop:"solid",borderBottom:"solid",borderColor:"white",position:"relative",children:[(0,i.jsx)(r.xu,{textAlign:"right",marginBottom:"10px",paddingTop:"35px",children:(0,i.jsx)(S,{})}),(0,i.jsx)(r.xu,{backgroundColor:"black",width:"96vw",height:"54vw",position:"absolute",top:"50%",marginTop:"-27vw",children:(0,i.jsx)("iframe",{src:d,height:"100%",width:"100%"})})]})}var C=n(7297),O=n(5063),P=n(5436);function T(e){var t=e.labName,n=e.currentValue;return(0,i.jsxs)(r.xu,{width:"100%",height:"8vh",backgroundColor:"#fc8712",marginBottom:"2vh",position:"relative",borderRadius:30,children:[(0,i.jsx)(r.xv,{position:"absolute",display:"flex",alignItems:"center",height:"6vh",left:"15px",fontSize:"25px",top:"50%",marginTop:"-3vh",textColor:"white",fontWeight:"bold",children:t}),(0,i.jsx)(r.xv,{position:"absolute",display:"flex",alignItems:"center",height:"6vh",right:"15px",fontSize:"25px",top:"50%",marginTop:"-3vh",fontWeight:"bold",textColor:"white",children:n||0})]})}function _(){var e=(0,C.Z)(["\n  subscription GetLabStatusSubscription {\n    labResult {\n      Ca\n      KH\n      Mg\n      NO3\n      PO4\n    }\n  }\n"]);return _=function(){return e},e}var D=(0,O.Ps)(_()),I={Ca:0,KH:0,Mg:0,NO3:0,PO4:0};function N(){var e=function(){var e=(0,v.Z)((function(){var e,t;return(0,m.__generator)(this,(function(n){switch(n.label){case 0:return[4,fetch("https://aqua-test.silver-lining.hk:2053/water/waterQuality")];case 1:return[4,n.sent().json()];case 2:return e=n.sent(),console.log("labData",e.data),(null===e||void 0===e?void 0:e.data)&&(t=null===e||void 0===e?void 0:e.data,a(t)),[2]}}))}));return function(){return e.apply(this,arguments)}}(),t=(0,o.useState)(I),n=t[0],a=t[1],s=(0,P.m)(D).data;return(0,o.useEffect)((function(){e().then()}),[]),(0,o.useEffect)((function(){if(null===s||void 0===s?void 0:s.labResult){var e={Ca:s.labResult.Ca,Mg:s.labResult.Mg,KH:s.labResult.KH,NO3:s.labResult.NO3,PO4:s.labResult.PO4};a(e)}}),[s]),(0,i.jsxs)(r.xu,{width:"28vw",height:"50vh",marginX:"auto",children:[(0,i.jsx)(T,{labName:"Ca",currentValue:n.Ca}),(0,i.jsx)(T,{labName:"Mg",currentValue:n.Mg}),(0,i.jsx)(T,{labName:"KH",currentValue:n.KH}),(0,i.jsx)(T,{labName:"NO3",currentValue:n.NO3}),(0,i.jsx)(T,{labName:"PO4",currentValue:n.PO4})]})}n(8683);var z=n(5113),R=n(9116),A=n(5504),E=n(2345);function M(){var e=f(),t=e.sid,n=e.phOffset,a=e.orpOffset,s=(0,o.useState)(""),l=s[0],d=s[1],c={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sid:t,phOffset:n||1,orpOffset:a||0,pw:l})},u=function(){var e=(0,v.Z)((function(){return(0,m.__generator)(this,(function(e){return fetch("".concat("https://aqua-test.silver-lining.hk:2053","/aqua/resetRecord"),c).then(function(){var e=(0,v.Z)((function(e){return(0,m.__generator)(this,(function(t){return[2,e.json()]}))}));return function(t){return e.apply(this,arguments)}}()),[2]}))}));return function(){return e.apply(this,arguments)}}();return(0,i.jsx)(E.Z,{contentStyle:{width:"40vw"},trigger:(0,i.jsx)(r.xu,{display:"inline",height:"6vh",_hover:{cursor:"pointer"},onClick:u,marginTop:"20px",children:(0,i.jsxs)(r.xv,{color:"#fc8712",fontSize:"50px",children:[(0,i.jsx)(A.L,{color:"#fc8712",size:"5vh"})," Reset"]})}),modal:!0,nested:!0,children:function(e){return(0,i.jsxs)(r.xu,{className:"modal",display:"block",width:"35vw",margin:"0 auto",children:[(0,i.jsx)(z.zx,{position:"absolute",top:0,right:0,className:"close",onClick:e,children:"\xd7"}),(0,i.jsx)(r.xu,{marginTop:"4vh",verticalAlign:"middle",paddingBottom:"4vh",minWidth:"100%",children:(0,i.jsxs)("form",{onSubmit:u,children:[(0,i.jsx)(R.II,{fontSize:["20px","20px","20px","35px","35px","35px"],display:"block",type:"password",placeholder:"Enter password",minWidth:"35vw",width:"35vw",maxWidth:"35vw",marginX:"auto",minHeight:["30px","30px","30px","55px","55px","55px"],value:l,onChange:function(e){d(e.target.value)},isRequired:!0}),(0,i.jsx)(R.II,{backgroundColor:"#fc8712",display:"block",type:"submit",value:"Reset",width:"15vw",fontSize:["20px","20px","20px","35px","35px","35px"],marginTop:"1vh",marginX:"auto",minHeight:["30px","30px","30px","55px","55px","55px"]})]})})]})}})}var B=n(4541),H=n(3162),K=n.n(H);function X(){var e=f(),t=e.sid,n=e.phOffset,o=e.orpOffset,a={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sid:t,phOffset:n||1,orpOffset:o||0})},s=function(){var e=(0,v.Z)((function(){return(0,m.__generator)(this,(function(e){return fetch("".concat("https://aqua-test.silver-lining.hk:2053","/aqua/downloadCSV"),a).then(function(){var e=(0,v.Z)((function(e){return(0,m.__generator)(this,(function(t){return[2,e.blob()]}))}));return function(t){return e.apply(this,arguments)}}()).then((function(e){return K().saveAs(e,"aquaCondition.csv")})),[2]}))}));return function(){return e.apply(this,arguments)}}();return(0,i.jsx)(r.xu,{display:"inline",height:"6vh",_hover:{cursor:"pointer"},onClick:s,children:(0,i.jsxs)(r.xv,{color:"#fc8712",fontSize:"50px",children:[(0,i.jsx)(B.Q,{color:"#fc8712",size:"5vh"})," Save"]})})}var q=n(4843);function Z(){var e=f(),t=(e.sid,e.phOffset),n=e.orpOffset,o=e.setPhOffset,a=e.setORPOffset;return(0,i.jsx)(E.Z,{contentStyle:{width:"38vw"},trigger:(0,i.jsx)(r.xu,{display:"inline",height:"6vh",marginTop:"20px",_hover:{cursor:"pointer"},children:(0,i.jsxs)(r.xv,{color:"#fc8712",fontSize:"50px",fontWeight:"",children:[(0,i.jsx)(q.Z,{color:"#fc8712",size:"5vh"})," Offset"]})}),position:"top center",nested:!0,children:function(e){return(0,i.jsxs)(r.xu,{className:"modal",display:"block",width:"35vw",margin:"0 auto",children:[(0,i.jsx)(z.zx,{position:"absolute",top:0,right:0,className:"close",onClick:e,children:"\xd7"}),(0,i.jsxs)(r.xu,{marginTop:"4vh",paddingBottom:"2vh",children:[(0,i.jsxs)(r.xu,{display:"block",paddingBottom:"10px",children:[(0,i.jsx)(r.xv,{fontSize:["20px","20px","20px","35px","35px","35px"],display:"inline-block",fontWeight:"bold",children:"pH_Offset:"}),(0,i.jsx)(R.II,{display:"inline-block",type:"number",fontSize:["20px","20px","20px","35px","35px","35px"],width:"8vw",value:t,onChange:function(e){o(e.target.value)}})]}),(0,i.jsxs)(r.xu,{display:"block",children:[(0,i.jsx)(r.xv,{fontSize:["20px","20px","20px","35px","35px","35px"],fontWeight:"bold",display:"inline-block",children:"ORP_Offset:"}),(0,i.jsx)(R.II,{display:"inline-block",type:"number",fontSize:["20px","20px","20px","35px","35px","35px"],width:"8vw",value:n,onChange:function(e){a(e.target.value)}})]})]})]})}})}function L(){return(0,i.jsx)(r.xu,{height:"15vh",display:"inline-block",width:"100%",children:(0,i.jsxs)(r.xu,{width:"30vw",height:"100%",marginX:"auto",children:[(0,i.jsx)(X,{}),(0,i.jsx)(M,{}),(0,i.jsx)(Z,{})]})})}var W=n(797),V=n(7887),Y=n(1163),$=n(9253),G=n(5310),Q=n(3023),J=n(5358),U=n(4888),F=n(6880);function ee(e){var t=e.data,n=e.type,o=e.lastElement,a=e.unit,s=e.dataKey,l=f(),c=l.startDate,u=l.endDate;return(0,i.jsxs)(r.xu,{display:"inline-block",children:[(0,i.jsxs)(r.xv,{fontSize:["20px","20px","20px","35px","35px","35px"],children:[n," : ",o," ",a]}),(0,i.jsx)(r.xu,{backgroundColor:"#fc8712",width:"56vw",height:"17vh",paddingRight:"0",paddingLeft:"0",paddingTop:"0",paddingBottom:"0",children:(0,i.jsx)($.h,{width:"95%",height:"100%",children:(0,i.jsxs)(G.w,{data:t,margin:{top:15,right:0,left:0,bottom:0},children:[(0,i.jsx)(Q.K,{dataKey:"dateTime",type:"number",scale:"utc",axisLine:{stroke:"white"},label:{fill:"white"},stroke:"white",domain:[d()(c).toDate().getTime(),d()(u).endOf("day").toDate().getTime()],tick:!1,height:20,color:"white"}),(0,i.jsx)(J.B,{width:40,color:"white",stroke:"white",axisLine:{stroke:"white"},label:{fill:"white"}}),(0,i.jsx)(U.u,{content:function(e){var t=e.active,n=e.payload,o=e.label;if(t&&n&&n.length){var s=new Date(o).toLocaleString("en-GB");return(0,i.jsxs)(r.xu,{backgroundColor:"white",display:"BLOCK",children:[(0,i.jsx)("p",{children:"".concat(s)}),(0,i.jsxs)("p",{children:["".concat(n[0].value," ").concat(a)," "]})]})}return null}}),(0,i.jsx)(F.x,{type:"monotone",dataKey:s,stroke:"white",dot:!1})]})})})]})}function te(){var e=(0,C.Z)(["\n  query GetAquaCondition(\n    $schoolId: Int!\n    $startday: DateTime\n    $endday: DateTime\n  ) {\n    records(\n      where: {\n        sid: { equals: $schoolId }\n        date_time: { lte: $endday, gte: $startday }\n      }\n      orderBy: { date_time: asc }\n    ) {\n      date_time\n      temperature\n      ph\n      orp\n      salty\n    }\n  }\n"]);return te=function(){return e},e}function ne(){var e=(0,C.Z)(["\n  subscription SubscribeAquaCondition($schoolId: Int!) {\n    addedRecord(sid: $schoolId) {\n      sid\n      date_time\n      temperature\n      ph\n      orp\n      salty\n    }\n  }\n"]);return ne=function(){return e},e}d()().format;var ie=(0,O.Ps)(te()),re=(0,O.Ps)(ne());function oe(e){var t,n,a,s,l,c,u=(0,Y.useRouter)(),h=f(),p=h.orpOffset,x=h.phOffset,g=h.startDate,v=h.endDate,m=(0,V.a)(ie,{variables:{schoolId:1,startday:g,endday:v}}),j=m.loading,b=m.error,w=m.data,y=m.subscribeToMore;(0,o.useEffect)((function(){y({document:re,variables:{schoolId:1},updateQuery:function(e,t){var n=t.subscriptionData;if(!n.data)return e;var i=n.data.addedRecord;return 99==n.data.addedRecord.temperature?(u.reload(),e):Object.assign({},e,{records:(0,W.Z)(e.records).concat([i])})}})}),[]);var S=null===w||void 0===w?void 0:w.records.map((function(e,t){return{dateTime:d()(e.date_time).toDate().getTime(),temperature:e.temperature,ph:e.ph,orp:e.orp,salty:e.salty}})),k=w?null===(t=w.records[w.records.length-1])||void 0===t?void 0:t.temperature:0,C=w?x?(null===(n=null===w||void 0===w?void 0:w.records[w.records.length-1])||void 0===n?void 0:n.ph)*x:null===(a=null===w||void 0===w?void 0:w.records[w.records.length-1])||void 0===a?void 0:a.ph:0,O=w?p?(null===(s=null===w||void 0===w?void 0:w.records[w.records.length-1])||void 0===s?void 0:s.orp)+p:null===(l=null===w||void 0===w?void 0:w.records[w.records.length-1])||void 0===l?void 0:l.orp:0,P=w?null===(c=w.records[w.records.length-1])||void 0===c?void 0:c.salty:0;return j?(0,i.jsx)(r.kC,{children:"Loading..."}):b?(0,i.jsxs)(r.kC,{children:["Error! ",b.message]}):(0,i.jsxs)(r.xu,{height:"100%",width:"56vw",marginX:"auto",children:[(0,i.jsx)(ee,{data:S,type:"Temp",lastElement:k,unit:"\xb0C",dataKey:"temperature"}),(0,i.jsx)(ee,{data:S,type:"pH",lastElement:C,unit:"",dataKey:"ph"}),(0,i.jsx)(ee,{data:S,type:"ORP",lastElement:O,unit:"mV",dataKey:"orp"}),(0,i.jsx)(ee,{data:S,type:"SALT",lastElement:P,unit:"ppt",dataKey:"salty"})]})}function ae(){return(0,i.jsxs)(r.xu,{width:"96vw",height:"86vh",marginX:"auto",borderTop:"solid",borderBottom:"solid",borderColor:"white",position:"relative",children:[(0,i.jsxs)(r.xu,{height:"100%",width:"35vw",position:"absolute",top:0,borderRight:"solid",borderColor:"white",display:"inline-block",children:[(0,i.jsx)(r.xu,{textAlign:"center",marginBottom:"10px",paddingTop:"35px",children:(0,i.jsx)(S,{})}),(0,i.jsx)(N,{}),(0,i.jsx)(L,{})]}),(0,i.jsx)(r.xu,{height:"100%",width:"60vw",position:"absolute",top:0,left:"35vw",children:(0,i.jsx)(oe,{})})]})}function se(e){return"Graph"===e.selectedPage?(0,i.jsx)(g,{sid:1,children:(0,i.jsx)(ae,{})}):(0,i.jsx)(k,{})}var le=n(1924);function de(e){var t=e.camId,n=e.pageName,o=e.selectedPage,a=e.setSelectedPage,s=w().setSelectedCam,l=o===n?"brown":"#fc8712";return(0,i.jsx)(z.zx,{backgroundColor:l,borderRadius:"20px",height:"60px",width:"19vw",fontWeight:"bold",color:"white",display:"block",marginBottom:"10px",marginX:"auto",onClick:function(){s(t),a(n)},position:"absolute",top:"50%",marginTop:"-30px",children:(0,i.jsxs)(r.xu,{position:"relative",children:[(0,i.jsx)(r.xu,{position:"absolute",left:"2px",marginX:"auto",height:"36px",top:"50%",marginTop:"-9px",children:(0,i.jsx)(le.V,{size:"18px",color:"white"})}),(0,i.jsx)(r.xu,{display:"inline-block",children:(0,i.jsx)(r.xv,{display:"inline-block",fontSize:"12px",textAlign:"center",verticalAlign:"middle",children:n})})]})})}var ce=n(1194);function ue(e){var t=e.selectedPage,n=e.setSelectedPage,o="Graph",a=t===o?"brown":"#fc8712";return(0,i.jsx)(z.zx,{backgroundColor:a,borderRadius:"20px",height:"60px",width:"19vw",fontWeight:"bold",color:"white",display:"block",marginBottom:"10px",marginX:"auto",onClick:function(){n(o)},position:"absolute",top:"50%",marginTop:"-30px",children:(0,i.jsxs)(r.xu,{position:"relative",children:[(0,i.jsx)(r.xu,{position:"absolute",left:"2px",marginX:"auto",height:"36px",top:"50%",marginTop:"-9px",children:(0,i.jsx)(ce.n,{size:"18px",color:"white"})}),(0,i.jsx)(r.xu,{display:"inline-block",textAlign:"center",paddingX:"3px",children:(0,i.jsx)(r.xv,{display:"block",fontSize:"12px",textAlign:"center",verticalAlign:"middle",children:o})})]})})}function he(e){var t=e.selectedPage,n=e.setSelectedPage;return(0,i.jsx)(r.xu,{position:"absolute",bottom:0,width:"100%",height:"7vh",children:(0,i.jsxs)(r.rj,{as:"footer",paddingX:"20px",width:"100%",height:"100%",gridTemplateAreas:{base:'"graph cam1 cam2 cam3"'},children:[(0,i.jsx)(r.P4,{gridArea:"graph",children:(0,i.jsx)(ue,{selectedPage:t,setSelectedPage:n})}),(0,i.jsx)(r.P4,{gridArea:"cam1",children:(0,i.jsx)(de,{selectedPage:t,setSelectedPage:n,camId:1,pageName:"CAM1"})}),(0,i.jsx)(r.P4,{gridArea:"cam2",children:(0,i.jsx)(de,{selectedPage:t,setSelectedPage:n,camId:2,pageName:"CAM2"})}),(0,i.jsx)(r.P4,{gridArea:"cam3",children:(0,i.jsx)(de,{selectedPage:t,setSelectedPage:n,camId:3,pageName:"CAM3"})})]})})}function pe(){var e=(0,o.useState)("Graph"),t=e[0],n=e[1];return(0,i.jsx)(r.xu,{width:"100vw",height:"92.5vh",children:(0,i.jsxs)(y,{children:[(0,i.jsx)(se,{selectedPage:t}),(0,i.jsx)(he,{selectedPage:t,setSelectedPage:n})]})})}function xe(e){return(0,i.jsxs)(r.xu,{children:[(0,i.jsx)(s,{}),(0,i.jsx)(pe,{})]})}}},function(e){e.O(0,[499,463,774,888,179],(function(){return t=2383,e(e.s=t);var t}));var t=e.O();_N_E=t}]);