(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[246],{2383:function(t,e,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/aqua",function(){return n(6759)}])},6759:function(t,e,n){"use strict";n.r(e),n.d(e,{default:function(){return it}});var i=n(828),r=n(5893),o=n(2684),a=n(8527),s=n(7294),d=n(4651);function l(t){return(0,r.jsxs)(a.xu,{width:"100vw",height:"13vh",maxH:"13vh",display:"inline-block",position:"relative",marginBottom:"5px",children:[(0,r.jsx)(a.xu,{width:"40vw",height:"100%",display:"inline-block",position:"absolute",top:0,left:0,children:(0,r.jsx)(a.xu,{height:"100%",width:"30vw",paddingLeft:"20px",children:(0,r.jsx)(d.Ee,{src:"/logo.png",boxSize:"100%",objectFit:"contain",objectPosition:"left center"})})}),(0,r.jsx)(a.xu,{width:"60vw",height:"100%",textAlign:"center",display:"inline-block",position:"absolute",top:0,right:0,children:(0,r.jsx)(a.xu,{height:"90%",children:(0,r.jsx)(a.xv,{fontSize:["18px","20px","20px","34px","34px","34px"],color:"grey",position:"absolute",bottom:0,right:"20px",children:"5G Real-time Aqua Monitor"})})})]})}n(8683);var c=n(7568),u=n(7582),h=n(5113),p=n(9116),x=n(5504),f=n(2345),g=n(7484),v=n.n(g),m=v()().toDate().toString(),j=v()().subtract(7,"day").toDate().toString(),b=["","","",""],y={sid:0,startDate:m,endDate:j,phOffset:1,orpOffset:0,pwData:"",schooldIcon:"",setPhOffset:function(){},setORPOffset:function(){},setPwData:function(){}},w=(0,s.createContext)(y),O=function(){var t=(0,s.useContext)(w);return{sid:t.sid,startDate:t.startDate,endDate:t.endDate,phOffset:t.phOffset,orpOffset:t.orpOffset,pwData:t.pwData,schooldIcon:t.schooldIcon,setPhOffset:t.setPhOffset,setORPOffset:t.setORPOffset,setPwData:t.setPwData}},k=function(t){var e=t.children,n=t.sid,i=(0,s.useState)(m),o=i[0],a=i[1],d=(0,s.useState)(j),l=d[0],c=d[1],u=(0,s.useState)(1),h=u[0],p=u[1],x=(0,s.useState)(0),f=x[0],g=x[1],y=(0,s.useState)(Math.random()),O=y[0],k=y[1],C=(0,s.useState)(""),S=C[0],D=C[1],_=b[n+1];return(0,s.useEffect)((function(){var t=v()().toDate().toString(),e=v()().subtract(7,"day").toDate().toString();a(e),c(t),setTimeout((function(){return k(Math.random())}),36e5)}),[O]),(0,r.jsx)(w.Provider,{value:{sid:n,startDate:o,endDate:l,phOffset:h,orpOffset:f,pwData:S,schooldIcon:_,setPhOffset:p,setORPOffset:g,setPwData:D},children:e})};function C(){var t=O(),e=t.sid,n=t.phOffset,i=t.orpOffset,o=(0,s.useState)(""),d=o[0],l=o[1],g={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sid:e,phOffset:n||1,orpOffset:i||0,pw:d})},v=function(){var t=(0,c.Z)((function(){return(0,u.__generator)(this,(function(t){return fetch("".concat("https://aqua-test.silver-lining.hk:2053","/aqua/resetRecord"),g).then(function(){var t=(0,c.Z)((function(t){return(0,u.__generator)(this,(function(e){return[2,t.json()]}))}));return function(e){return t.apply(this,arguments)}}()),[2]}))}));return function(){return t.apply(this,arguments)}}();return(0,r.jsx)(f.Z,{contentStyle:{width:"23vw"},trigger:(0,r.jsx)(a.xu,{display:"inline-block",height:"100%",marginRight:"15px",_hover:{cursor:"pointer"},onClick:v,children:(0,r.jsxs)(a.xv,{color:"orange",fontSize:"25px",children:[(0,r.jsx)(x.L,{color:"orange",size:"8vh"})," Reset"]})}),modal:!0,nested:!0,children:function(t){return(0,r.jsxs)(a.xu,{className:"modal",display:"block",width:"15vw",margin:"0 auto",children:[(0,r.jsx)(h.zx,{position:"absolute",top:0,right:0,className:"close",onClick:t,children:"\xd7"}),(0,r.jsx)(a.xu,{marginTop:"8vh",verticalAlign:"middle",paddingBottom:"8vh",children:(0,r.jsxs)("form",{onSubmit:v,children:[(0,r.jsx)(p.II,{display:"inline",type:"password",placeholder:"Enter password",value:d,onChange:function(t){l(t.target.value)},isRequired:!0}),(0,r.jsx)(p.II,{backgroundColor:"orange",display:"inline-block",type:"submit",value:"Reset",marginTop:"3vh"})]})})]})}})}var S=n(4541),D=n(3162),_=n.n(D);function P(){var t=O(),e=t.sid,n=t.phOffset,i=t.orpOffset,o={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sid:e,phOffset:n||1,orpOffset:i||0})},s=function(){var t=(0,c.Z)((function(){return(0,u.__generator)(this,(function(t){return fetch("".concat("https://aqua-test.silver-lining.hk:2053","/aqua/downloadCSV"),o).then(function(){var t=(0,c.Z)((function(t){return(0,u.__generator)(this,(function(e){return[2,t.blob()]}))}));return function(e){return t.apply(this,arguments)}}()).then((function(t){return _().saveAs(t,"aquaCondition.csv")})),[2]}))}));return function(){return t.apply(this,arguments)}}();return(0,r.jsx)(a.xu,{display:"inline-block",height:"100%",marginRight:"15px",_hover:{cursor:"pointer"},onClick:s,children:(0,r.jsxs)(a.xv,{color:"orange",fontSize:"25px",children:[(0,r.jsx)(S.Q,{color:"orange",size:"8vh"})," Save"]})})}var T=n(4843);function I(){var t=O(),e=(t.sid,t.phOffset),n=t.orpOffset,i=t.setPhOffset,o=t.setORPOffset;return(0,r.jsx)(f.Z,{trigger:(0,r.jsx)(a.xu,{display:"inline-block",height:"100%",marginRight:"15px",_hover:{cursor:"pointer"},children:(0,r.jsxs)(a.xv,{color:"orange",fontSize:"25px",children:[(0,r.jsx)(T.Z,{color:"orange",size:"8vh"})," Offset Data"]})}),nested:!0,children:function(t){return(0,r.jsxs)(a.xu,{className:"modal",display:"block",width:"15vw",margin:"0 auto",children:[(0,r.jsx)(h.zx,{position:"absolute",top:0,right:0,className:"close",onClick:t,children:"\xd7"}),(0,r.jsxs)(a.xu,{marginTop:"7vh",paddingBottom:"4vh",children:[(0,r.jsxs)(a.xu,{display:"inline",children:[(0,r.jsx)(a.xv,{fontSize:"sm",display:"inline-block",fontWeight:"bold",width:"7vw",children:"pH offset:"}),(0,r.jsx)(p.II,{display:"inline-block",type:"number",size:"xs ",width:"4vw",marginRight:"10px",value:e,onChange:function(t){i(t.target.value)}})]}),(0,r.jsxs)(a.xu,{display:"inline",children:[(0,r.jsx)(a.xv,{fontSize:"sm",fontWeight:"bold",width:"7vw",display:"inline-block",children:"ORP offset:"}),(0,r.jsx)(p.II,{display:"inline-block",type:"number",size:"xs ",width:"4vw",marginRight:"10px",value:n,onChange:function(t){o(t.target.value)}})]})]})]})}})}function R(){return(0,r.jsx)(a.xu,{position:"relative",marginBottom:"10vh",children:(0,r.jsx)(a.xu,{height:"13vh",borderTop:"solid",width:"99%",borderColor:"white",position:"absolute",right:0,children:(0,r.jsxs)(a.xu,{height:"12vh",paddingY:"2vh",children:[(0,r.jsx)(P,{}),(0,r.jsx)(C,{}),(0,r.jsx)(I,{})]})})})}var z=n(7297),A=n(9815),E=n(5254),q=n(5850),B=n(1163),N=n(9253),Z=n(5310),K=n(3023),L=n(5358),M=n(4888),$=n(6880);function Y(t){var e=t.data,n=t.type,i=t.lastElement,o=t.unit,s=t.dataKey,d=O(),l=d.startDate,c=d.endDate;return(0,r.jsxs)(a.xu,{display:"inline-block",paddingRight:"2vw",paddingY:2,children:[(0,r.jsxs)(a.xv,{fontSize:"23px",children:[n," : ",i," ",o]}),(0,r.jsx)(a.xu,{backgroundColor:"orange",width:"30vw",height:"28vh",paddingRight:"0",paddingLeft:"0",paddingTop:"0",paddingBottom:"0",children:(0,r.jsx)(N.h,{width:"95%",height:"100%",children:(0,r.jsxs)(Z.w,{data:e,margin:{top:15,right:0,left:0,bottom:0},children:[(0,r.jsx)(K.K,{dataKey:"dateTime",type:"number",scale:"utc",domain:[v()(l).toDate().getTime(),v()(c).endOf("day").toDate().getTime()],tick:!1,height:20}),(0,r.jsx)(L.B,{width:40}),(0,r.jsx)(M.u,{content:function(t){var e=t.active,n=t.payload,i=t.label;if(e&&n&&n.length){var s=new Date(i).toLocaleString("en-GB");return(0,r.jsxs)(a.xu,{backgroundColor:"white",display:"BLOCK",children:[(0,r.jsx)("p",{children:"".concat(s)}),(0,r.jsxs)("p",{children:["".concat(n[0].value," ").concat(o)," "]})]})}return null}}),(0,r.jsx)($.x,{type:"monotone",dataKey:s,stroke:"#8884d8"})]})})})]})}function X(){var t=(0,z.Z)(["\n  query GetAquaCondition(\n    $schoolId: Int!\n    $startday: DateTime\n    $endday: DateTime\n  ) {\n    records(\n      where: {\n        sid: { equals: $schoolId }\n        date_time: { lte: $endday, gte: $startday }\n      }\n      orderBy: { date_time: asc }\n    ) {\n      date_time\n      temperature\n      ph\n      orp\n      salty\n    }\n  }\n"]);return X=function(){return t},t}function H(){var t=(0,z.Z)(["\n  subscription SubscribeAquaCondition($schoolId: Int!) {\n    addedRecord(sid: $schoolId) {\n      sid\n      date_time\n      temperature\n      ph\n      orp\n      salty\n    }\n  }\n"]);return H=function(){return t},t}v()().format;var W=(0,E.Ps)(X()),G=(0,E.Ps)(H());function V(t){var e,n,i,o,d,l,c=(0,B.useRouter)(),u=O(),h=u.orpOffset,p=u.phOffset,x=u.startDate,f=u.endDate,g=(0,q.a)(W,{variables:{schoolId:1,startday:x,endday:f}}),m=g.loading,j=g.error,b=g.data,y=g.subscribeToMore;(0,s.useEffect)((function(){y({document:G,variables:{schoolId:1},updateQuery:function(t,e){var n=e.subscriptionData;if(!n.data)return t;var i=n.data.addedRecord;return 99==n.data.addedRecord.temperature?(c.reload(),t):Object.assign({},t,{records:(0,A.Z)(t.records).concat([i])})}})}),[]);var w=null===b||void 0===b?void 0:b.records.map((function(t,e){return{dateTime:v()(t.date_time).toDate().getTime(),temperature:t.temperature,ph:t.ph,orp:t.orp,salty:t.salty}})),k=b?null===(e=b.records[b.records.length-1])||void 0===e?void 0:e.temperature:0,C=b?p?(null===(n=null===b||void 0===b?void 0:b.records[b.records.length-1])||void 0===n?void 0:n.ph)*p:null===(i=null===b||void 0===b?void 0:b.records[b.records.length-1])||void 0===i?void 0:i.ph:0,S=b?h?(null===(o=null===b||void 0===b?void 0:b.records[b.records.length-1])||void 0===o?void 0:o.orp)+h:null===(d=null===b||void 0===b?void 0:b.records[b.records.length-1])||void 0===d?void 0:d.orp:0,D=b?null===(l=b.records[b.records.length-1])||void 0===l?void 0:l.salty:0;return m?(0,r.jsx)(a.kC,{children:"Loading..."}):j?(0,r.jsxs)(a.kC,{children:["Error! ",j.message]}):(0,r.jsxs)(a.xu,{display:"inline-block",children:[(0,r.jsx)(Y,{data:w,type:"Temp",lastElement:k,unit:"\xb0C",dataKey:"temperature"}),(0,r.jsx)(Y,{data:w,type:"pH",lastElement:C,unit:"",dataKey:"ph"}),(0,r.jsx)(Y,{data:w,type:"ORP",lastElement:S,unit:"mV",dataKey:"orp"}),(0,r.jsx)(Y,{data:w,type:"SALT",lastElement:D,unit:"ppt",dataKey:"salty"})]})}var F=n(1924);function J(t){var e=t.camId,n=t.selectedCam,i=t.setSelectedCam,o="CAM"+e,s=n===e?"brown":"orange";return(0,r.jsx)(h.zx,{backgroundColor:s,borderRadius:"20px",height:"60px",width:"19vw",fontWeight:"bold",color:"white",display:"block",marginBottom:"10px",marginX:"auto",onClick:function(){i(e)},children:(0,r.jsxs)(a.xu,{children:[(0,r.jsx)(a.xu,{position:"absolute",display:"inline-block",left:"9px",top:"9px",marginY:"auto",verticalAlign:"middle",children:(0,r.jsx)(F.V,{size:"7vh",color:"white"})}),(0,r.jsx)(a.xu,{display:"inline-block",children:(0,r.jsx)(a.xv,{display:"inline-block",fontSize:"20px",textAlign:"center",verticalAlign:"middle",children:o})})]})})}function Q(t){return(0,r.jsx)(a.xv,{fontSize:["20px","20px","20px","35px","35px","35px"],textAlign:"center",color:"#6b6b6b",marginBottom:"10px",children:v()().format("DD MMM YYYY \xa0 HH:mm")})}var U=["https://aqua-test.silver-lining.hk:2053/stream/1","https://aqua-test.silver-lining.hk:2053/stream/2","https://aqua-test.silver-lining.hk:2053/stream/3"];function tt(){var t=(0,s.useState)(1),e=t[0],n=t[1];return(0,r.jsxs)(a.xu,{borderLeft:"solid",borderColor:"white",height:"100%",children:[(0,r.jsx)(Q,{}),(0,r.jsxs)(a.xu,{children:[(0,r.jsx)(J,{camId:1,selectedCam:e,setSelectedCam:n}),(0,r.jsx)(J,{camId:2,selectedCam:e,setSelectedCam:n}),(0,r.jsx)(J,{camId:3,selectedCam:e,setSelectedCam:n})]}),(0,r.jsx)(a.xu,{marginX:"auto",backgroundColor:"black",textAlign:"center",width:"25vw",marginTop:"3vh",children:(0,r.jsx)("video",{src:U[e-1]})})]})}function et(t){return(0,r.jsxs)(a.rj,{as:"main",paddingX:"20px",width:"100vw",height:"84.5vh",gridTemplateAreas:{base:'"graph graph graph livestream"'},children:[(0,r.jsx)(a.P4,{gridArea:"graph",children:(0,r.jsxs)(k,{sid:1,children:[(0,r.jsx)(R,{}),(0,r.jsx)(V,{})]})}),(0,r.jsx)(a.P4,{gridArea:"livestream",borderTop:"solid",borderColor:"white",children:(0,r.jsx)(tt,{})})]})}function nt(t){return(0,r.jsxs)(a.kC,{w:"100vw",h:"100vh",backgroundColor:"#00072D",direction:"column",align:"center",justify:"center",children:[(0,r.jsx)(a.xu,{w:"45vw",h:"45vw",children:(0,r.jsx)(d.Ee,{src:"/rotatephone.gif",boxSize:"100%",objectFit:"contain"})}),(0,r.jsx)(a.xu,{fontSize:"80px",fontWeight:"bold",marginTop:"20px",marginX:"auto",color:"white",children:(0,r.jsx)(a.xv,{textAlign:"center",children:"\u8acb\u65cb\u8f49\u87a2\u5e55"})})]})}function it(t){var e=(0,i.Z)((0,o.ac)("(orientation: portrait)"),1)[0];return console.log(e),e?(0,r.jsx)(nt,{}):(0,r.jsxs)(a.xu,{children:[(0,r.jsx)(l,{}),(0,r.jsx)(et,{})]})}}},function(t){t.O(0,[499,296,774,888,179],(function(){return e=2383,t(t.s=e);var e}));var e=t.O();_N_E=e}]);