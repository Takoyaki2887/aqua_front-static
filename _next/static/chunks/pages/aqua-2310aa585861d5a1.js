(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[246],{2383:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/aqua",function(){return n(2964)}])},2964:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return ge}});var i=n(5893),r=n(8527),o=n(7294),a=n(4651);function s(e){return(0,i.jsxs)(r.xu,{width:"100vw",height:"7vh",maxH:"13vh",display:"inline-block",position:"relative",marginBottom:"5px",children:[(0,i.jsx)(r.xu,{width:"40vw",height:"100%",display:"inline-block",position:"absolute",top:0,left:0,children:(0,i.jsx)(r.xu,{height:"100%",width:"50vw",paddingLeft:"20px",children:(0,i.jsx)(a.Ee,{src:"/logo.png",boxSize:"100%",objectFit:"contain",objectPosition:"left center"})})}),(0,i.jsx)(r.xu,{width:"48vw",height:"100%",textAlign:"center",display:"inline-block",position:"absolute",top:0,right:0,children:(0,i.jsx)(r.xu,{height:"4vh",position:"absolute",top:"50%",marginTop:"-2vh",width:"100%",children:(0,i.jsx)(r.xv,{fontSize:["18px","20px","20px","37px","37px","37px"],color:"grey",position:"relative",textAlign:"center",children:"5G Real-time Aqua Monitor"})})})]})}var l=n(7484),d=n.n(l),c=d()().toDate().toString(),u=d()().subtract(7,"day").toDate().toString(),h=["","","",""],p={sid:0,startDate:c,endDate:u,phOffset:1,orpOffset:0,pwData:"",schooldIcon:""},x=(0,o.createContext)(p),g=function(){return(0,o.useContext)(x)},v=function(e){var t=e.children,n=e.sid,r=(0,o.useState)(c),a=r[0],s=r[1],l=(0,o.useState)(u),p=l[0],g=l[1],v=(0,o.useState)(1),f=v[0],m=v[1],j=(0,o.useState)(0),b=j[0],w=j[1],y=(0,o.useState)(Math.random()),S=y[0],k=y[1],C=(0,o.useState)(""),O=C[0],P=C[1],T=h[n+1];return(0,o.useEffect)((function(){var e=d()().toDate().toString(),t=d()().subtract(7,"day").toDate().toString();s(t),g(e),setTimeout((function(){return k(Math.random())}),36e5)}),[S]),(0,i.jsx)(x.Provider,{value:{sid:n,startDate:a,endDate:p,phOffset:f,orpOffset:b,pwData:O,schooldIcon:T,setPhOffset:m,setORPOffset:w,setPwData:P},children:t})},f={selectedCam:1},m=(0,o.createContext)(f),j=function(){return(0,o.useContext)(m)},b=function(e){var t=e.children,n=(0,o.useState)(1),r=n[0],a=n[1];return(0,i.jsx)(m.Provider,{value:{selectedCam:r,setSelectedCam:a},children:t})};function w(){var e=(0,o.useState)(d()().format("DD MMM YYYY HH:mm")),t=e[0],n=e[1];return(0,o.useEffect)((function(){setInterval((function(){return n(d()().format("DD MMM YYYY HH:mm"))}),5e4)}),[]),(0,i.jsx)(r.xv,{fontSize:["20px","20px","20px","40px","40px","40px"],color:"#6b6b6b",children:t})}var y=["https://www.youtube.com/embed/tz5M_zFejHo?autoplay=1&mute=1&controls=0","https://www.youtube.com/embed/GIICrR9Bkis?autoplay=1&mute=1&controls=0","https://www.youtube.com/embed/7KoHWgdk0O4?autoplay=1&mute=1&controls=0"];function S(){var e=j().selectedCam;return(0,i.jsxs)(r.xu,{width:"96vw",height:"86vh",marginX:"auto",borderTop:"solid",borderBottom:"solid",borderColor:"white",position:"relative",children:[(0,i.jsx)(r.xu,{textAlign:"right",marginBottom:"10px",paddingTop:"35px",children:(0,i.jsx)(w,{})}),(0,i.jsx)(r.xu,{backgroundColor:"black",width:"96vw",height:"54vw",position:"absolute",top:"50%",marginTop:"-27vw",children:(0,i.jsx)("iframe",{src:y[e-1],height:"100%",width:"100%"})})]})}var k=n(7568),C=n(7297),O=n(7582),P=n(5063),T=n(5436);function _(e){var t=e.labName,n=e.currentValue;return(0,i.jsxs)(r.xu,{width:"100%",height:"8vh",backgroundColor:"orange",marginBottom:"2vh",position:"relative",borderRadius:30,children:[(0,i.jsx)(r.xv,{position:"absolute",display:"flex",alignItems:"center",height:"6vh",left:"15px",fontSize:"50px",top:"50%",marginTop:"-3vh",children:t}),(0,i.jsx)(r.xv,{position:"absolute",display:"flex",alignItems:"center",height:"6vh",right:"15px",fontSize:"50px",top:"50%",marginTop:"-3vh",children:n||0})]})}function z(){var e=(0,C.Z)(["\n  subscription GetLabStatusSubscription {\n    labResult {\n      Ca\n      KH\n      Mg\n      NO3\n      PO4\n    }\n  }\n"]);return z=function(){return e},e}var D=(0,P.Ps)(z()),I={Ca:0,KH:0,Mg:0,NO3:0,PO4:0};function N(){var e=function(){var e=(0,k.Z)((function(){var e,t;return(0,O.__generator)(this,(function(n){switch(n.label){case 0:return[4,fetch("https://aqua-test.silver-lining.hk:2053/water/waterQuality")];case 1:return[4,n.sent().json()];case 2:return e=n.sent(),console.log("labData",e.data),(null===e||void 0===e?void 0:e.data)&&(t=null===e||void 0===e?void 0:e.data,a(t)),[2]}}))}));return function(){return e.apply(this,arguments)}}(),t=(0,o.useState)(I),n=t[0],a=t[1],s=(0,T.m)(D).data;return(0,o.useEffect)((function(){e()}),[]),(0,o.useEffect)((function(){if(null===s||void 0===s?void 0:s.labResult){var e={Ca:s.labResult.Ca,Mg:s.labResult.Mg,KH:s.labResult.KH,NO3:s.labResult.NO3,PO4:s.labResult.PO4};a(e)}}),[s]),(0,i.jsxs)(r.xu,{width:"28vw",height:"50vh",marginX:"auto",children:[(0,i.jsx)(_,{labName:"Ca",currentValue:n.Ca}),(0,i.jsx)(_,{labName:"Mg",currentValue:n.Mg}),(0,i.jsx)(_,{labName:"KH",currentValue:n.KH}),(0,i.jsx)(_,{labName:"NO3",currentValue:n.NO3}),(0,i.jsx)(_,{labName:"PO4",currentValue:n.PO4})]})}n(8683);var R=n(5113),A=n(9116),M=n(5504),E=n(2345);function B(){var e=g(),t=e.sid,n=e.phOffset,a=e.orpOffset,s=(0,o.useState)(""),l=s[0],d=s[1],c={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sid:t,phOffset:n||1,orpOffset:a||0,pw:l})},u=function(){var e=(0,k.Z)((function(){return(0,O.__generator)(this,(function(e){return fetch("".concat("https://aqua-test.silver-lining.hk:2053","/aqua/resetRecord"),c).then(function(){var e=(0,k.Z)((function(e){return(0,O.__generator)(this,(function(t){return[2,e.json()]}))}));return function(t){return e.apply(this,arguments)}}()),[2]}))}));return function(){return e.apply(this,arguments)}}();return(0,i.jsx)(E.Z,{contentStyle:{width:"40vw"},trigger:(0,i.jsx)(r.xu,{display:"inline",height:"6vh",_hover:{cursor:"pointer"},onClick:u,marginTop:"20px",children:(0,i.jsxs)(r.xv,{color:"orange",fontSize:"50px",children:[(0,i.jsx)(M.L,{color:"orange",size:"5vh"})," Reset"]})}),modal:!0,nested:!0,children:function(e){return(0,i.jsxs)(r.xu,{className:"modal",display:"block",width:"35vw",margin:"0 auto",children:[(0,i.jsx)(R.zx,{position:"absolute",top:0,right:0,className:"close",onClick:e,children:"\xd7"}),(0,i.jsx)(r.xu,{marginTop:"4vh",verticalAlign:"middle",paddingBottom:"4vh",minWidth:"100%",children:(0,i.jsxs)("form",{onSubmit:u,children:[(0,i.jsx)(A.II,{fontSize:["20px","20px","20px","35px","35px","35px"],display:"block",type:"password",placeholder:"Enter password",minWidth:"35vw",width:"35vw",maxWidth:"35vw",marginX:"auto",minHeight:["30px","30px","30px","55px","55px","55px"],value:l,onChange:function(e){d(e.target.value)},isRequired:!0}),(0,i.jsx)(A.II,{backgroundColor:"orange",display:"block",type:"submit",value:"Reset",width:"15vw",fontSize:["20px","20px","20px","35px","35px","35px"],marginTop:"1vh",marginX:"auto",minHeight:["30px","30px","30px","55px","55px","55px"]})]})})]})}})}var H=n(4541),K=n(3162),q=n.n(K);function X(){var e=g(),t=e.sid,n=e.phOffset,o=e.orpOffset,a={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sid:t,phOffset:n||1,orpOffset:o||0})},s=function(){var e=(0,k.Z)((function(){return(0,O.__generator)(this,(function(e){return fetch("".concat("https://aqua-test.silver-lining.hk:2053","/aqua/downloadCSV"),a).then(function(){var e=(0,k.Z)((function(e){return(0,O.__generator)(this,(function(t){return[2,e.blob()]}))}));return function(t){return e.apply(this,arguments)}}()).then((function(e){return q().saveAs(e,"aquaCondition.csv")})),[2]}))}));return function(){return e.apply(this,arguments)}}();return(0,i.jsx)(r.xu,{display:"inline",height:"6vh",_hover:{cursor:"pointer"},onClick:s,children:(0,i.jsxs)(r.xv,{color:"orange",fontSize:"50px",children:[(0,i.jsx)(H.Q,{color:"orange",size:"5vh"})," Save"]})})}var Z=n(4843);function Y(){var e=g(),t=(e.sid,e.phOffset),n=e.orpOffset,o=e.setPhOffset,a=e.setORPOffset;return(0,i.jsx)(E.Z,{contentStyle:{width:"38vw"},trigger:(0,i.jsx)(r.xu,{display:"inline",height:"6vh",marginTop:"20px",_hover:{cursor:"pointer"},children:(0,i.jsxs)(r.xv,{color:"orange",fontSize:"50px",fontWeight:"",children:[(0,i.jsx)(Z.Z,{color:"orange",size:"5vh"})," Offset"]})}),position:"top center",nested:!0,children:function(e){return(0,i.jsxs)(r.xu,{className:"modal",display:"block",width:"35vw",margin:"0 auto",children:[(0,i.jsx)(R.zx,{position:"absolute",top:0,right:0,className:"close",onClick:e,children:"\xd7"}),(0,i.jsxs)(r.xu,{marginTop:"4vh",paddingBottom:"2vh",children:[(0,i.jsxs)(r.xu,{display:"block",paddingBottom:"10px",children:[(0,i.jsx)(r.xv,{fontSize:["20px","20px","20px","35px","35px","35px"],display:"inline-block",fontWeight:"bold",children:"pH_Offset:"}),(0,i.jsx)(A.II,{display:"inline-block",type:"number",fontSize:["20px","20px","20px","35px","35px","35px"],width:"8vw",value:t,onChange:function(e){o(e.target.value)}})]}),(0,i.jsxs)(r.xu,{display:"block",children:[(0,i.jsx)(r.xv,{fontSize:["20px","20px","20px","35px","35px","35px"],fontWeight:"bold",display:"inline-block",children:"ORP_Offset:"}),(0,i.jsx)(A.II,{display:"inline-block",type:"number",fontSize:["20px","20px","20px","35px","35px","35px"],width:"8vw",value:n,onChange:function(e){a(e.target.value)}})]})]})]})}})}function V(){return(0,i.jsx)(r.xu,{height:"15vh",position:"absolute",bottom:"40px",width:"100%",children:(0,i.jsxs)(r.xu,{width:"30vw",height:"100%",marginX:"auto",children:[(0,i.jsx)(X,{}),(0,i.jsx)(B,{}),(0,i.jsx)(Y,{})]})})}var W=n(797),G=n(7887),L=n(1163),$=n(9253),Q=n(5310),F=n(3023),J=n(5358),U=n(4888),ee=n(6880);function te(e){var t=e.data,n=e.type,o=e.lastElement,a=e.unit,s=e.dataKey,l=g(),c=l.startDate,u=l.endDate;return(0,i.jsxs)(r.xu,{display:"inline-block",paddingRight:"2vw",paddingY:2,children:[(0,i.jsxs)(r.xv,{fontSize:["20px","20px","20px","40px","40px","40px"],children:[n," : ",o," ",a]}),(0,i.jsx)(r.xu,{backgroundColor:"orange",width:"56vw",height:"17vh",paddingRight:"0",paddingLeft:"0",paddingTop:"0",paddingBottom:"0",children:(0,i.jsx)($.h,{width:"95%",height:"100%",children:(0,i.jsxs)(Q.w,{data:t,margin:{top:15,right:0,left:0,bottom:0},children:[(0,i.jsx)(F.K,{dataKey:"dateTime",type:"number",scale:"utc",domain:[d()(c).toDate().getTime(),d()(u).endOf("day").toDate().getTime()],tick:!1,height:20}),(0,i.jsx)(J.B,{width:40}),(0,i.jsx)(U.u,{content:function(e){var t=e.active,n=e.payload,o=e.label;if(t&&n&&n.length){var s=new Date(o).toLocaleString("en-GB");return(0,i.jsxs)(r.xu,{backgroundColor:"white",display:"BLOCK",children:[(0,i.jsx)("p",{children:"".concat(s)}),(0,i.jsxs)("p",{children:["".concat(n[0].value," ").concat(a)," "]})]})}return null}}),(0,i.jsx)(ee.x,{type:"monotone",dataKey:s,stroke:"#8884d8",dot:!1})]})})})]})}function ne(){var e=(0,C.Z)(["\n  query GetAquaCondition(\n    $schoolId: Int!\n    $startday: DateTime\n    $endday: DateTime\n  ) {\n    records(\n      where: {\n        sid: { equals: $schoolId }\n        date_time: { lte: $endday, gte: $startday }\n      }\n      orderBy: { date_time: asc }\n    ) {\n      date_time\n      temperature\n      ph\n      orp\n      salty\n    }\n  }\n"]);return ne=function(){return e},e}function ie(){var e=(0,C.Z)(["\n  subscription SubscribeAquaCondition($schoolId: Int!) {\n    addedRecord(sid: $schoolId) {\n      sid\n      date_time\n      temperature\n      ph\n      orp\n      salty\n    }\n  }\n"]);return ie=function(){return e},e}d()().format;var re=(0,P.Ps)(ne()),oe=(0,P.Ps)(ie());function ae(e){var t,n,a,s,l,c,u=(0,L.useRouter)(),h=g(),p=h.orpOffset,x=h.phOffset,v=h.startDate,f=h.endDate,m=(0,G.a)(re,{variables:{schoolId:1,startday:v,endday:f}}),j=m.loading,b=m.error,w=m.data,y=m.subscribeToMore;(0,o.useEffect)((function(){y({document:oe,variables:{schoolId:1},updateQuery:function(e,t){var n=t.subscriptionData;if(!n.data)return e;var i=n.data.addedRecord;return 99==n.data.addedRecord.temperature?(u.reload(),e):Object.assign({},e,{records:(0,W.Z)(e.records).concat([i])})}})}),[]);var S=null===w||void 0===w?void 0:w.records.map((function(e,t){return{dateTime:d()(e.date_time).toDate().getTime(),temperature:e.temperature,ph:e.ph,orp:e.orp,salty:e.salty}})),k=w?null===(t=w.records[w.records.length-1])||void 0===t?void 0:t.temperature:0,C=w?x?(null===(n=null===w||void 0===w?void 0:w.records[w.records.length-1])||void 0===n?void 0:n.ph)*x:null===(a=null===w||void 0===w?void 0:w.records[w.records.length-1])||void 0===a?void 0:a.ph:0,O=w?p?(null===(s=null===w||void 0===w?void 0:w.records[w.records.length-1])||void 0===s?void 0:s.orp)+p:null===(l=null===w||void 0===w?void 0:w.records[w.records.length-1])||void 0===l?void 0:l.orp:0,P=w?null===(c=w.records[w.records.length-1])||void 0===c?void 0:c.salty:0;return j?(0,i.jsx)(r.kC,{children:"Loading..."}):b?(0,i.jsxs)(r.kC,{children:["Error! ",b.message]}):(0,i.jsxs)(r.xu,{height:"100%",width:"56vw",marginX:"auto",children:[(0,i.jsx)(te,{data:S,type:"Temp",lastElement:k,unit:"\xb0C",dataKey:"temperature"}),(0,i.jsx)(te,{data:S,type:"pH",lastElement:C,unit:"",dataKey:"ph"}),(0,i.jsx)(te,{data:S,type:"ORP",lastElement:O,unit:"mV",dataKey:"orp"}),(0,i.jsx)(te,{data:S,type:"SALT",lastElement:P,unit:"ppt",dataKey:"salty"})]})}function se(){return(0,i.jsxs)(r.xu,{width:"96vw",height:"86vh",marginX:"auto",borderTop:"solid",borderBottom:"solid",borderColor:"white",position:"relative",children:[(0,i.jsxs)(r.xu,{height:"100%",width:"35vw",position:"absolute",top:0,borderRight:"solid",borderColor:"white",display:"inline-block",children:[(0,i.jsx)(r.xu,{textAlign:"center",marginBottom:"10px",paddingTop:"35px",children:(0,i.jsx)(w,{})}),(0,i.jsx)(N,{}),(0,i.jsx)(V,{})]}),(0,i.jsx)(r.xu,{height:"100%",width:"60vw",position:"absolute",top:0,left:"35vw",children:(0,i.jsx)(ae,{})})]})}function le(e){return"Graph"===e.selectedPage?(0,i.jsx)(v,{sid:1,children:(0,i.jsx)(se,{})}):(0,i.jsx)(b,{children:(0,i.jsx)(S,{})})}var de=n(1924);function ce(e){var t=e.camId,n=e.pageName,o=e.selectedPage,a=e.setSelectedPage,s=j().setSelectedCam,l=o===n?"brown":"orange";return(0,i.jsx)(R.zx,{backgroundColor:l,borderRadius:"20px",height:"60px",width:"19vw",fontWeight:"bold",color:"white",display:"block",marginBottom:"10px",marginX:"auto",onClick:function(){s(t),a(n)},position:"absolute",top:"50%",marginTop:"-30px",children:(0,i.jsxs)(r.xu,{children:[(0,i.jsx)(r.xu,{position:"absolute",display:"inline-block",left:"12px",top:"9px",marginY:"auto",verticalAlign:"middle",children:(0,i.jsx)(de.V,{size:"2vh",color:"white"})}),(0,i.jsx)(r.xu,{display:"inline-block",children:(0,i.jsx)(r.xv,{display:"inline-block",fontSize:"20px",textAlign:"center",verticalAlign:"middle",children:n})})]})})}var ue=n(1194);function he(e){var t=e.selectedPage,n=e.setSelectedPage,o="Graph",a=t===o?"brown":"orange";return(0,i.jsx)(R.zx,{backgroundColor:a,borderRadius:"20px",height:"60px",width:"19vw",fontWeight:"bold",color:"white",display:"block",marginBottom:"10px",marginX:"auto",onClick:function(){n(o)},position:"absolute",top:"50%",marginTop:"-30px",children:(0,i.jsxs)(r.xu,{children:[(0,i.jsx)(r.xu,{position:"absolute",display:"inline-block",left:"12px",top:"9px",marginY:"auto",verticalAlign:"middle",children:(0,i.jsx)(ue.n,{size:"2vh",color:"white"})}),(0,i.jsx)(r.xu,{display:"inline-block",children:(0,i.jsx)(r.xv,{display:"inline-block",fontSize:"20px",textAlign:"center",verticalAlign:"middle",children:o})})]})})}function pe(e){var t=e.selectedPage,n=e.setSelectedPage;return(0,i.jsx)(r.xu,{position:"absolute",bottom:0,width:"100%",height:"7vh",children:(0,i.jsxs)(r.rj,{as:"footer",paddingX:"20px",width:"100%",height:"100%",gridTemplateAreas:{base:'"graph cam1 cam2 cam3"'},children:[(0,i.jsx)(r.P4,{gridArea:"graph",children:(0,i.jsx)(he,{selectedPage:t,setSelectedPage:n})}),(0,i.jsx)(r.P4,{gridArea:"cam1",children:(0,i.jsx)(b,{children:(0,i.jsx)(ce,{selectedPage:t,setSelectedPage:n,camId:1,pageName:"CAM1"})})}),(0,i.jsx)(r.P4,{gridArea:"cam2",children:(0,i.jsx)(b,{children:(0,i.jsx)(ce,{selectedPage:t,setSelectedPage:n,camId:2,pageName:"CAM2"})})}),(0,i.jsx)(r.P4,{gridArea:"cam3",children:(0,i.jsx)(b,{children:(0,i.jsx)(ce,{selectedPage:t,setSelectedPage:n,camId:3,pageName:"CAM3"})})})]})})}function xe(){var e=(0,o.useState)("Graph"),t=e[0],n=e[1];return(0,i.jsxs)(r.xu,{width:"100vw",height:"92.5vh",children:[(0,i.jsx)(le,{selectedPage:t}),(0,i.jsx)(pe,{selectedPage:t,setSelectedPage:n})]})}function ge(e){return(0,i.jsxs)(r.xu,{children:[(0,i.jsx)(s,{}),(0,i.jsx)(xe,{})]})}}},function(e){e.O(0,[499,463,774,888,179],(function(){return t=2383,e(e.s=t);var t}));var t=e.O();_N_E=t}]);