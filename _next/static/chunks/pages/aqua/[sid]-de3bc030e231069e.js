(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[568],{6579:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/aqua/[sid]",function(){return n(6113)}])},6113:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return H}});var r=n(5893),i=n(3236),a=n(7294),o=n(4651),s=n(1163);function d(e){var t=(0,s.useRouter)();if(void 0!==t.query.sid){parseInt(t.query.sid,10);return(0,r.jsxs)(i.xu,{width:"100vw",height:"13vh",maxH:"13vh",display:"inline-block",position:"relative",marginBottom:"5px",children:[(0,r.jsx)(i.xu,{width:"60vw",height:"100%",display:"inline-block",position:"absolute",top:0,left:0,children:(0,r.jsx)(i.xu,{height:"100%",width:"30vw",paddingLeft:"20px",children:(0,r.jsx)(o.Ee,{src:"/logo.png",boxSize:"100%",objectFit:"contain",objectPosition:"left center"})})}),(0,r.jsx)(i.xu,{width:"40vw",height:"100%",textAlign:"center",display:"inline-block",position:"absolute",top:0,right:0,children:(0,r.jsx)(i.xu,{height:"90%",children:(0,r.jsx)(i.xv,{fontSize:"34px",color:"grey",position:"absolute",bottom:0,right:"20px",children:"5G Real-time Aqua Monitor"})})})]})}return(0,r.jsx)(r.Fragment,{})}var l=n(4541),c=n(5504),u=n(4843);function h(e){var t=(0,s.useRouter)();parseInt(t.query.sid,10);return(0,r.jsx)(i.xu,{position:"relative",marginBottom:"10vh",children:(0,r.jsx)(i.xu,{height:"13vh",borderTop:"solid",width:"99%",borderColor:"white",position:"absolute",right:0,children:(0,r.jsxs)(i.xu,{height:"9vh",paddingY:"2vh",children:[(0,r.jsx)(i.xu,{display:"inline-block",height:"100%",marginRight:"15px",children:(0,r.jsxs)(i.xv,{color:"orange",fontSize:"25px",children:[(0,r.jsx)(l.Q,{color:"orange",size:"8vh"})," Save"]})}),(0,r.jsx)(i.xu,{display:"inline-block",height:"100%",marginRight:"15px",children:(0,r.jsxs)(i.xv,{color:"orange",fontSize:"25px",children:[(0,r.jsx)(c.L,{color:"orange",size:"8vh"})," Reset"]})}),(0,r.jsx)(i.xu,{display:"inline-block",height:"100%",marginRight:"15px",children:(0,r.jsxs)(i.xv,{color:"orange",fontSize:"25px",children:[(0,r.jsx)(u.Z,{color:"orange",size:"8vh"})," Offset Data"]})})]})})})}var p=n(7297),x=n(797),g=n(5254),f=n(5850),v=n(7484),m=n.n(v),j=m()().toDate().toString(),b=m()().subtract(7,"day").toDate().toString(),y=["","","",""],w={sid:0,startDate:j,endDate:b,phOffset:1,orpOffset:0,pwData:"",schooldIcon:"",setPhOffset:function(){},setORPOffset:function(){},setPwData:function(){}},D=(0,a.createContext)(w),k=function(){var e=(0,a.useContext)(D);return{sid:e.sid,startDate:e.startDate,endDate:e.endDate,phOffset:e.phOffset,orpOffset:e.orpOffset,pwData:e.pwData,schooldIcon:e.schooldIcon,setPhOffset:e.setPhOffset,setORPOffset:e.setORPOffset,setPwData:e.setPwData}},O=function(e){var t=e.children,n=e.sid,i=(0,a.useState)(j),o=i[0],s=i[1],d=(0,a.useState)(b),l=d[0],c=d[1],u=(0,a.useState)(1),h=u[0],p=u[1],x=(0,a.useState)(0),g=x[0],f=x[1],v=(0,a.useState)(Math.random()),w=v[0],k=v[1],O=(0,a.useState)(""),C=O[0],S=O[1],R=y[n+1];return(0,a.useEffect)((function(){var e=m()().toDate().toString(),t=m()().subtract(7,"day").toDate().toString();s(t),c(e),setTimeout((function(){return k(Math.random())}),36e5)}),[w]),(0,r.jsx)(D.Provider,{value:{sid:n,startDate:o,endDate:l,phOffset:h,orpOffset:g,pwData:C,schooldIcon:R,setPhOffset:p,setORPOffset:f,setPwData:S},children:t})},C=n(9253),S=n(5310),R=n(3023),I=n(5358),P=n(4888),T=n(6880);function _(e){var t=e.data,n=e.type,a=e.lastElement,o=e.unit,d=e.dataKey,l=((0,s.useRouter)(),k()),c=l.startDate,u=l.endDate;return(0,r.jsxs)(i.xu,{display:"inline-block",paddingRight:16,paddingY:2,children:[(0,r.jsxs)(i.xv,{fontSize:"23px",children:[n," : ",a," ",o]}),(0,r.jsx)(i.xu,{backgroundColor:"orange",width:"30vw",height:"28vh",paddingRight:"0",paddingLeft:"0",paddingTop:"0",paddingBottom:"0",children:(0,r.jsx)(C.h,{width:"95%",height:"100%",children:(0,r.jsxs)(S.w,{data:t,margin:{top:15,right:0,left:0,bottom:0},children:[(0,r.jsx)(R.K,{dataKey:"dateTime",type:"number",scale:"utc",domain:[m()(c).toDate().getTime(),m()(u).endOf("day").toDate().getTime()],tick:!1,height:20}),(0,r.jsx)(I.B,{width:40}),(0,r.jsx)(P.u,{content:function(e){var t=e.active,n=e.payload,a=e.label;if(t&&n&&n.length){var s=new Date(a).toLocaleString("en-GB");return(0,r.jsxs)(i.xu,{backgroundColor:"white",display:"BLOCK",children:[(0,r.jsx)("p",{children:"".concat(s)}),(0,r.jsxs)("p",{children:["".concat(n[0].value," ").concat(o)," "]})]})}return null}}),(0,r.jsx)(T.x,{type:"monotone",dataKey:d,stroke:"#8884d8"})]})})})]})}function q(){var e=(0,p.Z)(["\n  query GetAquaCondition(\n    $schoolId: Int!\n    $startday: DateTime\n    $endday: DateTime\n  ) {\n    records(\n      where: {\n        sid: { equals: $schoolId }\n        date_time: { lte: $endday, gte: $startday }\n      }\n      orderBy: { date_time: asc }\n    ) {\n      date_time\n      temperature\n      ph\n      orp\n      salty\n    }\n  }\n"]);return q=function(){return e},e}function A(){var e=(0,p.Z)(["\n  subscription SubscribeAquaCondition($schoolId: Int!) {\n    addedRecord(sid: $schoolId) {\n      sid\n      date_time\n      temperature\n      ph\n      orp\n      salty\n    }\n  }\n"]);return A=function(){return e},e}m()().format;var E=(0,g.Ps)(q()),z=(0,g.Ps)(A());function B(e){var t,n,o,d,l,c,u=(0,s.useRouter)(),h=parseInt(u.query.sid,10),p=k(),g=p.orpOffset,v=p.phOffset,j=p.startDate,b=p.endDate,y=(0,f.a)(E,{variables:{schoolId:h,startday:j,endday:b}}),w=y.loading,D=y.error,O=y.data,C=y.subscribeToMore;(0,a.useEffect)((function(){C({document:z,variables:{schoolId:h},updateQuery:function(e,t){var n=t.subscriptionData;if(!n.data)return e;var r=n.data.addedRecord;return 99==n.data.addedRecord.temperature?(u.reload(),e):Object.assign({},e,{records:(0,x.Z)(e.records).concat([r])})}})}),[]);var S=null===O||void 0===O?void 0:O.records.map((function(e,t){return{dateTime:m()(e.date_time).toDate().getTime(),temperature:e.temperature,ph:e.ph,orp:e.orp,salty:e.salty}})),R=O?null===(t=O.records[O.records.length-1])||void 0===t?void 0:t.temperature:0,I=O?v?(null===(n=null===O||void 0===O?void 0:O.records[O.records.length-1])||void 0===n?void 0:n.ph)*v:null===(o=null===O||void 0===O?void 0:O.records[O.records.length-1])||void 0===o?void 0:o.ph:0,P=O?g?(null===(d=null===O||void 0===O?void 0:O.records[O.records.length-1])||void 0===d?void 0:d.orp)+g:null===(l=null===O||void 0===O?void 0:O.records[O.records.length-1])||void 0===l?void 0:l.orp:0,T=O?null===(c=O.records[O.records.length-1])||void 0===c?void 0:c.salty:0;return w?(0,r.jsx)(i.kC,{children:"Loading..."}):D?(0,r.jsxs)(i.kC,{children:["Error! ",D.message]}):(0,r.jsxs)(i.xu,{display:"block",height:"100%",children:[(0,r.jsx)(_,{data:S,type:"Temp",lastElement:R,unit:"\xb0C",dataKey:"temperature"}),(0,r.jsx)(_,{data:S,type:"pH",lastElement:I,unit:"",dataKey:"ph"}),(0,r.jsx)(_,{data:S,type:"ORP",lastElement:P,unit:"mV",dataKey:"orp"}),(0,r.jsx)(_,{data:S,type:"SALT",lastElement:T,unit:"ppt",dataKey:"salty"})]})}var K=n(5113),L=n(1924);function M(e){var t=e.camId,n=e.selectedCam,a=e.setSelectedCam,o=(0,s.useRouter)(),d=(parseInt(o.query.sid,10),"CAM"+t),l=n===t?"brown":"orange";return(0,r.jsx)(K.zx,{backgroundColor:l,borderRadius:"20px",height:"60px",width:"19vw",fontWeight:"bold",color:"white",display:"block",marginBottom:"10px",marginX:"auto",onClick:function(){a(t)},children:(0,r.jsxs)(i.xu,{children:[(0,r.jsx)(i.xu,{position:"absolute",display:"inline-block",left:"9px",top:"9px",marginY:"auto",verticalAlign:"middle",children:(0,r.jsx)(L.V,{size:"7vh",color:"white"})}),(0,r.jsx)(i.xu,{display:"inline-block",children:(0,r.jsx)(i.xv,{display:"inline-block",fontSize:"20px",textAlign:"center",verticalAlign:"middle",children:d})})]})})}function Y(e){return(0,r.jsx)(i.xv,{fontSize:"35px",textAlign:"center",color:"#6b6b6b",marginBottom:"15px",children:m()().format("DD MMM YYYY \xa0 HH:mm")})}var $=["https://aqua-test.silver-lining.hk:2053/stream/1","https://aqua-test.silver-lining.hk:2053/stream/2","https://aqua-test.silver-lining.hk:2053/stream/3"];function X(){var e=(0,a.useState)(1),t=e[0],n=e[1];return(0,r.jsxs)(i.xu,{borderLeft:"solid",borderColor:"white",height:"100%",children:[(0,r.jsx)(Y,{}),(0,r.jsxs)(i.xu,{children:[(0,r.jsx)(M,{camId:1,selectedCam:t,setSelectedCam:n}),(0,r.jsx)(M,{camId:2,selectedCam:t,setSelectedCam:n}),(0,r.jsx)(M,{camId:3,selectedCam:t,setSelectedCam:n})]}),(0,r.jsx)(i.xu,{marginX:"auto",backgroundColor:"black",textAlign:"center",width:"25vw",marginTop:"5vh",children:(0,r.jsx)("video",{src:$[t-1]})})]})}function N(e){var t=(0,s.useRouter)();if(void 0!==t.query.sid){var n=parseInt(t.query.sid,10);return(0,r.jsxs)(i.rj,{as:"main",paddingX:"20px",width:"100vw",height:"84.5vh",gridTemplateAreas:{base:'"graph graph graph livestream"'},children:[(0,r.jsx)(i.P4,{gridArea:"graph",children:(0,r.jsxs)(O,{sid:n,children:[(0,r.jsx)(h,{}),(0,r.jsx)(B,{})]})}),(0,r.jsx)(i.P4,{gridArea:"livestream",borderTop:"solid",borderColor:"white",children:(0,r.jsx)(X,{})})]})}return(0,r.jsx)(r.Fragment,{})}function H(e){return(0,r.jsxs)(i.xu,{overflowX:"hidden",overflowY:"hidden",children:[(0,r.jsx)(d,{}),(0,r.jsx)(N,{})]})}}},function(e){e.O(0,[959,162,774,888,179],(function(){return t=6579,e(e.s=t);var t}));var t=e.O();_N_E=t}]);