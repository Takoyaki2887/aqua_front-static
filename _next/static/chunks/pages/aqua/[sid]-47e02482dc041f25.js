(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[568],{6579:function(t,e,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/aqua/[sid]",function(){return n(1851)}])},1851:function(t,e,n){"use strict";n.r(e),n.d(e,{default:function(){return M}});var r=n(5893),a=n(8527),i=n(7294),o=n(1163),s=n(7484),d=n.n(s),l=d()().toDate().toString(),u=d()().subtract(7,"day").toDate().toString(),c=["","","",""],f={sid:0,startDate:l,endDate:u,phOffset:1,orpOffset:0,pwData:"",schooldIcon:"",setPhOffset:function(){},setORPOffset:function(){},setPwData:function(){}},p=(0,i.createContext)(f),h=function(){var t=(0,i.useContext)(p);return{sid:t.sid,startDate:t.startDate,endDate:t.endDate,phOffset:t.phOffset,orpOffset:t.orpOffset,pwData:t.pwData,schooldIcon:t.schooldIcon,setPhOffset:t.setPhOffset,setORPOffset:t.setORPOffset,setPwData:t.setPwData}},x=function(t){var e=t.children,n=t.sid,a=(0,i.useState)(l),o=a[0],s=a[1],f=(0,i.useState)(u),h=f[0],x=f[1],m=(0,i.useState)(1),v=m[0],g=m[1],y=(0,i.useState)(0),j=y[0],C=y[1],b=(0,i.useState)(Math.random()),O=b[0],D=b[1],S=(0,i.useState)(""),w=S[0],_=S[1],k=c[n+1];return(0,i.useEffect)((function(){var t=d()().toDate().toString(),e=d()().subtract(7,"day").toDate().toString();s(e),x(t),setTimeout((function(){return D(Math.random())}),36e5)}),[O]),(0,r.jsx)(p.Provider,{value:{sid:n,startDate:o,endDate:h,phOffset:v,orpOffset:j,pwData:w,schooldIcon:k,setPhOffset:g,setORPOffset:C,setPwData:_},children:e})},m=n(7297),v=n(5254),g=n(5850),y=n(4651),j=n(9116),C=n(5113),b=n(7484);function O(){var t=(0,i.useState)(),e=t[0],n=t[1],o=(0,i.useState)(),s=o[0],d=o[1],l=(0,i.useState)(Math.random()),u=l[0],c=l[1];return(0,i.useEffect)((function(){var t=b().format("DD/MM/YYYY"),e=b().format("HH:mm");n(t),d(e),setTimeout((function(){return c(Math.random())}),6e4)}),[u]),(0,r.jsxs)(a.kC,{display:"inline-block",textColor:"#e534eb",children:[(0,r.jsx)(a.xv,{as:"abbr",marginRight:"40px",marginLeft:"35px",fontSize:"40px",children:e}),(0,r.jsx)(a.xv,{as:"abbr",fontSize:"40px",children:s})]})}b().format();var D=n(7568),S=n(7582),w=n(3162),_=n.n(w),k=n(3454);function P(){var t=h(),e=t.schooldIcon,n=t.setPhOffset,i=t.setORPOffset,o=t.setPwData,s=function(){var t=h(),e=t.sid,n=t.phOffset,r=t.orpOffset,a={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sid:e,phOffset:n||1,orpOffset:r||0})},i=function(){var t=(0,D.Z)((function(){return(0,S.__generator)(this,(function(t){return fetch("".concat(k.env.NEXT_PUBLIC_BACKEND_URL,"/aqua/downloadCSV"),a).then(function(){var t=(0,D.Z)((function(t){return(0,S.__generator)(this,(function(e){return[2,t.blob()]}))}));return function(e){return t.apply(this,arguments)}}()).then((function(t){return _().saveAs(t,"aquaCondition.csv")})),[2]}))}));return function(){return t.apply(this,arguments)}}(),o=function(){var t=(0,D.Z)((function(){return(0,S.__generator)(this,(function(t){return fetch("".concat(k.env.NEXT_PUBLIC_BACKEND_URL,"/aqua/resetRecord"),a).then(function(){var t=(0,D.Z)((function(t){return(0,S.__generator)(this,(function(e){return[2,t.json()]}))}));return function(e){return t.apply(this,arguments)}}()),[2]}))}));return function(){return t.apply(this,arguments)}}();return{downloadCsv:i,resetRecord:o}}(),d=s.downloadCsv,l=s.resetRecord;return(0,r.jsxs)(a.kC,{minWidth:"400",minHeight:"250",display:"inline-block",marginLeft:"10px",marginBottom:"10px",verticalAlign:"top",children:[(0,r.jsxs)(a.kC,{marginLeft:"35px",marginTop:"35px",children:[(0,r.jsx)(y.Ee,{src:e,width:"141px",height:"155px"}),(0,r.jsxs)(a.kC,{display:"BLOCK",marginLeft:"35px",children:[(0,r.jsxs)(a.kC,{marginBottom:"10px",children:[(0,r.jsx)(a.xv,{fontSize:"sm",textColor:"#e534eb",marginRight:"28px",children:"pH offset:"}),(0,r.jsx)(j.II,{textColor:"#e534eb",type:"number",size:"xs ",width:"35px",marginRight:"10px",onChange:function(t){n(t.target.value)}})]}),(0,r.jsxs)(a.kC,{children:[(0,r.jsx)(a.xv,{fontSize:"sm",textColor:"#e534eb",marginRight:"20px",children:"ORP offset:"}),(0,r.jsx)(j.II,{textColor:"#e534eb",type:"number",size:"xs ",width:"35px",marginRight:"10px",onChange:function(t){i(t.target.value)}})]})," ",(0,r.jsx)(C.zx,{display:"BLOCK",colorScheme:"teal",size:"xs",onClick:d,marginTop:"10px",children:"Download CSV File"}),(0,r.jsxs)("form",{onSubmit:l,children:[(0,r.jsx)(j.II,{textColor:"#e534eb",type:"password",size:"xs ",width:"120px",marginRight:"10px",marginTop:"10px",display:"inline",placeholder:"Enter password",onChange:function(t){o(t.target.value)},isRequired:!0}),(0,r.jsx)(C.zx,{display:"inline",colorScheme:"teal",size:"xs",type:"submit",children:"Reset"})]})]})]}),(0,r.jsx)(O,{})]})}var R=n(6122),I=n(3023),E=n(5358),T=n(4888),L=n(6108);function B(t){var e=t.data,n=t.type,i=t.lastElement,o=t.unit,s=t.dataKey;return(0,r.jsxs)(a.kC,{minWidth:"400",minHeight:"250",maxWidth:"400",maxHeight:"250",boxShadow:"md",p:"6",rounded:"md",display:"inline-block",border:"1px",marginLeft:"10px",marginBottom:"10px",paddingRight:"0",paddingLeft:"0",paddingTop:"0",paddingBottom:"0",borderStartColor:"#5c5c5c",borderEndColor:"#170047",bgGradient:"linear(to-br, #170047, #170047)",children:[(0,r.jsxs)(a.kC,{display:"BLOCK",textColor:"#e534eb",children:[(0,r.jsx)(a.kC,{paddingLeft:"30px",fontSize:"20px",fontWeight:"bold",fontFamily:"serif",children:n}),(0,r.jsxs)(a.kC,{paddingLeft:"30px",fontSize:"30px",fontFamily:"Verdana, Arial, Helvetica, sans-serif",children:[i," ",o]})]}),(0,r.jsxs)(R.T,{data:e,width:380,height:180,children:[(0,r.jsx)("defs",{children:(0,r.jsxs)("linearGradient",{id:"colorWeight",x1:"0",y1:"0",x2:"0",y2:"1",children:[(0,r.jsx)("stop",{offset:"50%",stopColor:"#00fbff",stopOpacity:.8}),(0,r.jsx)("stop",{offset:"100%",stopColor:"#ff00f7",stopOpacity:.6})]})}),(0,r.jsx)(I.K,{dataKey:"dateTime",type:"number",scale:"utc",color:"#e534eb",domain:["dataMin","dataMax"],tick:!1}),(0,r.jsx)(E.B,{tick:{fill:"#e534eb"}}),(0,r.jsx)(T.u,{content:function(t){var e=t.active,n=t.payload,i=t.label;if(e&&n&&n.length){var s=new Date(i).toLocaleString("en-GB");return(0,r.jsxs)(a.kC,{backgroundColor:"white",display:"BLOCK",children:[(0,r.jsx)("p",{children:"".concat(s)}),(0,r.jsxs)("p",{children:["".concat(n[0].value," ").concat(o)," "]})]})}return null}}),(0,r.jsx)(L.u,{type:"monotone",dataKey:s,stroke:"#0075ff",fillOpacity:1,fill:"url(#colorWeight)",color:"#e534eb"})]})]})}function K(){var t=(0,m.Z)(["\n  query GetAquaCondition(\n    $schoolId: Int!\n    $startday: DateTime\n    $endday: DateTime\n  ) {\n    records(\n      where: {\n        sid: { equals: $schoolId }\n        date_time: { lte: $endday, gte: $startday }\n      }\n      orderBy: { date_time: asc }\n    ) {\n      date_time\n      temperature\n      level\n      ph\n      orp\n      salty\n    }\n  }\n"]);return K=function(){return t},t}function z(){var t=(0,m.Z)(["\n  subscription SubscribeAquaCondition($schoolId: Int!) {\n    addedRecord(sid: $schoolId) {\n      sid\n      date_time\n      temperature\n      level\n      ph\n      orp\n      salty\n    }\n  }\n"]);return z=function(){return t},t}d()().format;var q=(0,v.Ps)(K());(0,v.Ps)(z());function N(t){var e,n,i,o,s,l,u,c=t.sid,f=h(),p=f.orpOffset,x=f.phOffset,m=f.startDate,v=f.endDate,y=(0,g.a)(q,{variables:{schoolId:c,startday:m,endday:v}}),j=(y.loading,y.error,y.data),C=(y.subscribeToMore,null===j||void 0===j?void 0:j.records.map((function(t,e){return{dateTime:d()(t.date_time).toDate().getTime(),temperature:t.temperature,level:t.level,ph:t.ph,orp:t.orp,salty:t.salty}})));return j?(0,r.jsxs)(a.xu,{backgroundColor:"#0d0029",display:"inline-block",children:[(0,r.jsx)(P,{}),(0,r.jsx)(B,{data:C,type:"Water temperature",lastElement:null===(e=j.records[-1])||void 0===e?void 0:e.temperature,unit:"\xb0C",dataKey:"temperature"}),(0,r.jsx)(B,{data:C,type:"Conductivity",lastElement:null===(n=j.records[-1])||void 0===n?void 0:n.level,unit:"mS",dataKey:"level"}),(0,r.jsx)(B,{data:C,type:"pH Value",lastElement:x?(null===(i=j.records[-1])||void 0===i?void 0:i.ph)*x:null===(o=j.records[-1])||void 0===o?void 0:o.ph,unit:"",dataKey:"ph"}),(0,r.jsx)(B,{data:C,type:"ORP Value",lastElement:p?(null===(s=j.records[-1])||void 0===s?void 0:s.orp)+p:null===(l=j.records[-1])||void 0===l?void 0:l.orp,unit:"mV",dataKey:"orp"}),(0,r.jsx)(B,{data:C,type:"Salinity",lastElement:null===(u=j.records[-1])||void 0===u?void 0:u.salty,unit:"ppt",dataKey:"salty"}),(0,r.jsx)(a.xu,{marginLeft:"10px",marginBottom:"10px",children:(0,r.jsx)("video",{width:"400",src:"https://aqua-test.silver-lining.hk:2053/stream"})})]}):(0,r.jsx)(r.Fragment,{})}function M(t){var e=(0,o.useRouter)();if(void 0!==e.query.sid){var n=parseInt(e.query.sid,10);return(0,r.jsx)(a.xu,{backgroundColor:"#0d0029",display:"inline-block",children:(0,r.jsx)(x,{sid:n,children:(0,r.jsx)(N,{sid:n})})})}return(0,r.jsx)(r.Fragment,{})}}},function(t){t.O(0,[527,247,774,888,179],(function(){return e=6579,t(t.s=e);var e}));var e=t.O();_N_E=e}]);